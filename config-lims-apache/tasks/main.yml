- name: Ensure www path exists 
  file: 
        path: "/var/www/htdocs/" 
        owner: us3
        group: apache 
        state: directory 


- name: Check if certs are already created/inplace for letsencrypt 
  stat: 
        path: "/etc/letsencrypt/live/{{ ansible_fqdn  }}/" 
  register: cert_path

- include_role: 
         name: geerlingguy.certbot
  when: cert_path.stat.exists == false

- name: Configure base apache2 config from template
  template: 
        src: httpd.conf.j2
        dest: /etc/httpd/conf/httpd.conf
        backup: yes

- name: Configure virtual host for redirect 
  template: 
        src: http-server.conf.j2
        dest: "/etc/httpd/conf.d/http-{{ ansible_hostname }}.conf" 
        backup: yes 
  notify: 
        - restart apache

- name: configure Virtual host for ssl 
  template: 
        src: https-server.conf.j2
        dest: "/etc/httpd/conf.d/https-{{ ansible_hostname }}.conf"
        backup: yes 
  notify: 
        - restart apache
